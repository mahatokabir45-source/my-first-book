<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Board</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --light-bg: #f8f9fa;
            --dark-bg: #212529;
            --light-text: #212529;
            --dark-text: #f8f9fa;
            --border-color: #dee2e6;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        body.dark-mode {
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }

        .dark-mode .card {
            background-color: #343a40;
            border-color: #495057;
        }

        .dark-mode .btn-outline-secondary {
            color: #adb5bd;
            border-color: #adb5bd;
        }

        .dark-mode .btn-outline-secondary:hover {
            background-color: #adb5bd;
            color: #212529;
        }

        .dark-mode .text-muted {
            color: #adb5bd !important;
        }

        .dark-mode .bg-light {
            background-color: #343a40 !important;
        }

        .dark-mode .border {
            border-color: #495057 !important;
        }

        .dark-mode .form-control {
            background-color: #495057;
            border-color: #6c757d;
            color: #f8f9fa;
        }

        .dark-mode .form-control:focus {
            background-color: #495057;
            color: #f8f9fa;
        }

        .header {
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1rem;
        }

        .dark-mode .header {
            border-bottom-color: #495057;
        }

        .canvas-container {
            position: relative;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            background-color: white;
            height: 500px;
            margin-bottom: 1rem;
        }

        .dark-mode .canvas-container {
            background-color: #343a40;
        }

        #drawingCanvas {
            cursor: crosshair;
            display: block;
        }

        .toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 1rem;
            padding: 1rem;
            background-color: var(--light-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .dark-mode .toolbar {
            background-color: #343a40;
        }

        .color-palette {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .color-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid #fff;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .color-btn:hover {
            transform: scale(1.1);
        }

        .color-btn.active {
            border: 3px solid #333;
            transform: scale(1.15);
        }

        .tool-btn {
            padding: 8px 16px;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .tool-btn:hover {
            transform: translateY(-2px);
        }

        .tool-btn.active {
            background-color: var(--primary-color);
            color: white;
        }

        .brush-size-slider {
            width: 100px;
        }

        .word-selection {
            position: absolute;
            background-color: rgba(59, 130, 246, 0.3);
            border: 1px dashed #3b82f6;
            pointer-events: none;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 4px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            transition: opacity 0.3s, transform 0.3s;
        }

        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        .feature-card {
            margin-bottom: 1.5rem;
            transition: transform 0.2s;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .stats-panel {
            background-color: var(--light-bg);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .dark-mode .stats-panel {
            background-color: #343a40;
        }

        .history-panel {
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- Header -->
        <div class="header">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h1 class="h3 mb-0">
                        <i class="fas fa-chalkboard mr-2"></i>
                        Smart Board
                    </h1>
                </div>
                <div class="col-md-6 text-md-end">
                    <button id="darkModeToggle" class="btn btn-outline-secondary">
                        <i class="fas fa-moon"></i>
                        <span class="ms-2">Dark Mode</span>
                    </button>
                    <button id="clearCanvas" class="btn btn-outline-danger ms-2">
                        <i class="fas fa-trash"></i>
                        Clear
                    </button>
                    <button id="downloadCanvas" class="btn btn-outline-success ms-2">
                        <i class="fas fa-download"></i>
                        Download
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="row">
            <!-- Left Sidebar -->
            <div class="col-md-3">
                <div class="card feature-card">
                    <div class="card-header">
                        <h5 class="mb-0">Tools</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-primary tool-btn active" data-tool="pen">
                                <i class="fas fa-pen"></i> Pen
                            </button>
                            <button class="btn btn-outline-secondary tool-btn" data-tool="eraser">
                                <i class="fas fa-eraser"></i> Eraser
                            </button>
                            <button class="btn btn-outline-secondary tool-btn" data-tool="text">
                                <i class="fas fa-font"></i> Text
                            </button>
                            <button class="btn btn-outline-secondary tool-btn" data-tool="select">
                                <i class="fas fa-mouse-pointer"></i> Select
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card feature-card">
                    <div class="card-header">
                        <h5 class="mb-0">Brush Size</h5>
                    </div>
                    <div class="card-body">
                        <input type="range" class="form-range brush-size-slider" id="brushSize" min="1" max="50" value="5">
                        <div class="text-center mt-2">
                            <span id="brushSizeValue">5px</span>
                        </div>
                    </div>
                </div>

                <div class="card feature-card">
                    <div class="card-header">
                        <h5 class="mb-0">Colors</h5>
                    </div>
                    <div class="card-body">
                        <div class="color-palette">
                            <div class="color-btn active" style="background-color: #000000" data-color="#000000"></div>
                            <div class="color-btn" style="background-color: #ff0000" data-color="#ff0000"></div>
                            <div class="color-btn" style="background-color: #00ff00" data-color="#00ff00"></div>
                            <div class="color-btn" style="background-color: #0000ff" data-color="#0000ff"></div>
                            <div class="color-btn" style="background-color: #ffff00" data-color="#ffff00"></div>
                            <div class="color-btn" style="background-color: #ff00ff" data-color="#ff00ff"></div>
                            <div class="color-btn" style="background-color: #00ffff" data-color="#00ffff"></div>
                            <div class="color-btn" style="background-color: #ffa500" data-color="#ffa500"></div>
                            <div class="color-btn" style="background-color: #800080" data-color="#800080"></div>
                            <div class="color-btn" style="background-color: #ffc0cb" data-color="#ffc0cb"></div>
                            <div class="color-btn" style="background-color: #a52a2a" data-color="#a52a2a"></div>
                            <div class="color-btn" style="background-color: #808080" data-color="#808080"></div>
                        </div>
                    </div>
                </div>

                <div class="card feature-card">
                    <div class="card-header">
                        <h5 class="mb-0">Text Settings</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="fontSize" class="form-label">Font Size</label>
                            <select class="form-select" id="fontSize">
                                <option value="12">12px</option>
                                <option value="14">14px</option>
                                <option value="16" selected>16px</option>
                                <option value="18">18px</option>
                                <option value="20">20px</option>
                                <option value="24">24px</option>
                                <option value="28">28px</option>
                                <option value="32">32px</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="fontFamily" class="form-label">Font Family</label>
                            <select class="form-select" id="fontFamily">
                                <option value="Arial">Arial</option>
                                <option value="Times New Roman">Times New Roman</option>
                                <option value="Courier New">Courier New</option>
                                <option value="Georgia">Georgia</option>
                                <option value="Verdana">Verdana</option>
                                <option value="Comic Sans MS">Comic Sans MS</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Canvas Area -->
            <div class="col-md-6">
                <div class="canvas-container">
                    <canvas id="drawingCanvas"></canvas>
                </div>
                
                <!-- Stats Panel -->
                <div class="stats-panel">
                    <div class="row">
                        <div class="col-4">
                            <div class="text-center">
                                <h6 class="text-muted">Strokes</h6>
                                <h4 id="strokeCount">0</h4>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="text-center">
                                <h6 class="text-muted">Words</h6>
                                <h4 id="wordCount">0</h4>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="text-center">
                                <h6 class="text-muted">Selections</h6>
                                <h4 id="selectionCount">0</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Sidebar -->
            <div class="col-md-3">
                <div class="card feature-card">
                    <div class="card-header">
                        <h5 class="mb-0">History</h5>
                    </div>
                    <div class="card-body history-panel">
                        <div id="historyList" class="list-group">
                            <div class="list-group-item text-muted">No actions yet</div>
                        </div>
                    </div>
                </div>

                <div class="card feature-card">
                    <div class="card-header">
                        <h5 class="mb-0">Quick Actions</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-primary" id="undoBtn">
                                <i class="fas fa-undo"></i> Undo
                            </button>
                            <button class="btn btn-outline-primary" id="redoBtn">
                                <i class="fas fa-redo"></i> Redo
                            </button>
                            <button class="btn btn-outline-info" id="saveBtn">
                                <i class="fas fa-save"></i> Save Board
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card feature-card">
                    <div class="card-header">
                        <h5 class="mb-0">Share</h5>
                    </div>
                    <div class="card-body">
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" id="shareLink" placeholder="Share link" readonly>
                            <button class="btn btn-outline-secondary" type="button" id="copyLink">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <div class="d-grid">
                            <button class="btn btn-outline-primary" id="shareBtn">
                                <i class="fas fa-share-alt"></i> Generate Link
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">
        <span id="notificationText"></span>
    </div>

    <!-- Text Input Modal -->
    <div class="modal fade" id="textModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Text</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="text" class="form-control" id="textInput" placeholder="Enter your text">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="addTextBtn">Add Text</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Canvas setup
            const canvas = document.getElementById('drawingCanvas');
            const ctx = canvas.getContext('2d');
            const canvasContainer = document.querySelector('.canvas-container');
            
            // Set canvas size
            function resizeCanvas() {
                canvas.width = canvasContainer.clientWidth;
                canvas.height = canvasContainer.clientHeight;
            }
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);

            // Drawing state
            let isDrawing = false;
            let currentTool = 'pen';
            let currentColor = '#000000';
            let brushSize = 5;
            let history = [];
            let historyStep = -1;
            let strokeCount = 0;
            let wordCount = 0;
            let selectionCount = 0;
            let textPosition = null;
            let isSelecting = false;
            let selectionStart = null;
            let selectionEnd = null;
            let selectedWords = [];

            // Save initial state
            saveState();

            // Tool selection
            document.querySelectorAll('.tool-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentTool = this.dataset.tool;
                    
                    if (currentTool === 'select') {
                        canvas.style.cursor = 'default';
                    } else {
                        canvas.style.cursor = 'crosshair';
                    }
                });
            });

            // Color selection
            document.querySelectorAll('.color-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentColor = this.dataset.color;
                });
            });

            // Brush size
            const brushSizeSlider = document.getElementById('brushSize');
            const brushSizeValue = document.getElementById('brushSizeValue');
            brushSizeSlider.addEventListener('input', function() {
                brushSize = this.value;
                brushSizeValue.textContent = `${brushSize}px`;
            });

            // Dark mode toggle
            const darkModeToggle = document.getElementById('darkModeToggle');
            darkModeToggle.addEventListener('click', function() {
                document.body.classList.toggle('dark-mode');
                const icon = this.querySelector('i');
                if (document.body.classList.contains('dark-mode')) {
                    icon.classList.remove('fa-moon');
                    icon.classList.add('fa-sun');
                    this.innerHTML = '<i class="fas fa-sun"></i><span class="ms-2">Light Mode</span>';
                } else {
                    icon.classList.remove('fa-sun');
                    icon.classList.add('fa-moon');
                    this.innerHTML = '<i class="fas fa-moon"></i><span class="ms-2">Dark Mode</span>';
                }
            });

            // Drawing functions
            function startDrawing(e) {
                if (currentTool === 'select') {
                    isSelecting = true;
                    selectionStart = getMousePos(e);
                    return;
                }
                
                if (currentTool === 'text') {
                    textPosition = getMousePos(e);
                    const textModal = new bootstrap.Modal(document.getElementById('textModal'));
                    textModal.show();
                    return;
                }

                isDrawing = true;
                const pos = getMousePos(e);
                
                ctx.beginPath();
                ctx.moveTo(pos.x, pos.y);
                
                if (currentTool === 'eraser') {
                    ctx.globalCompositeOperation = 'destination-out';
                } else {
                    ctx.globalCompositeOperation = 'source-over';
                    ctx.strokeStyle = currentColor;
                }
                
                ctx.lineWidth = brushSize;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
            }

            function draw(e) {
                if (!isDrawing && !isSelecting) return;
                
                if (isSelecting) {
                    const currentPos = getMousePos(e);
                    drawSelectionBox(selectionStart, currentPos);
                    return;
                }
                
                const pos = getMousePos(e);
                ctx.lineTo(pos.x, pos.y);
                ctx.stroke();
            }

            function stopDrawing() {
                if (isDrawing) {
                    isDrawing = false;
                    ctx.beginPath();
                    saveState();
                    updateStats();
                }
                
                if (isSelecting) {
                    isSelecting = false;
                    selectionEnd = getMousePos(event);
                    processSelection();
                }
            }

            function getMousePos(e) {
                const rect = canvas.getBoundingClientRect();
                return {
                    x: e.clientX - rect.left,
                    y: e.clientY - rect.top
                };
            }

            function drawSelectionBox(start, end) {
                // Clear canvas and redraw from history
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                if (historyStep >= 0) {
                    ctx.putImageData(history[historyStep], 0, 0);
                }
                
                // Draw selection box
                ctx.strokeStyle = '#3b82f6';
                ctx.lineWidth = 1;
                ctx.setLineDash([5, 5]);
                ctx.strokeRect(
                    start.x, 
                    start.y, 
                    end.x - start.x, 
                    end.y - start.y
                );
                ctx.setLineDash([]);
            }

            function processSelection() {
                // Simulate word selection
                const words = ['Hello', 'World', 'Smart', 'Board', 'Drawing', 'Text', 'Select', 'Color', 'Eraser'];
                const selectedWord = words[Math.floor(Math.random() * words.length)];
                
                // Highlight selected area
                ctx.fillStyle = 'rgba(59, 130, 246, 0.1)';
                ctx.fillRect(
                    selectionStart.x, 
                    selectionStart.y, 
                    selectionEnd.x - selectionStart.x, 
                    selectionEnd.y - selectionStart.y
                );
                
                // Add word to selected words
                if (!selectedWords.includes(selectedWord)) {
                    selectedWords.push(selectedWord);
                    selectionCount++;
                    updateStats();
                    addToHistory(`Selected word: ${selectedWord}`);
                }
                
                showNotification(`Word "${selectedWord}" selected!`);
            }

            // Text functionality
            document.getElementById('addTextBtn').addEventListener('click', function() {
                const text = document.getElementById('textInput').value;
                if (text) {
                    ctx.font = `${document.getElementById('fontSize').value}px ${document.getElementById('fontFamily').value}`;
                    ctx.fillStyle = currentColor;
                    ctx.fillText(text, textPosition.x, textPosition.y);
                    
                    wordCount++;
                    updateStats();
                    addToHistory(`Added text: ${text}`);
                    showNotification('Text added successfully!');
                    
                    document.getElementById('textInput').value = '';
                    bootstrap.Modal.getInstance(document.getElementById('textModal')).hide();
                    saveState();
                }
            });

            // Canvas event listeners
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            // Touch support
            canvas.addEventListener('touchstart', function(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent('mousedown', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            });

            canvas.addEventListener('touchmove', function(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent('mousemove', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            });

            canvas.addEventListener('touchend', function(e) {
                e.preventDefault();
                const mouseEvent = new MouseEvent('mouseup', {});
                canvas.dispatchEvent(mouseEvent);
            });

            // Clear canvas
            document.getElementById('clearCanvas').addEventListener('click', function() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                strokeCount = 0;
                wordCount = 0;
                selectionCount = 0;
                selectedWords = [];
                updateStats();
                addToHistory('Cleared canvas');
                saveState();
                showNotification('Canvas cleared!');
            });

            // Download canvas
            document.getElementById('downloadCanvas').addEventListener('click', function() {
                const link = document.createElement('a');
                link.download = 'smart-board.png';
                link.href = canvas.toDataURL();
                link.click();
                showNotification('Image downloaded!');
            });

            // Undo/Redo
            document.getElementById('undoBtn').addEventListener('click', function() {
                if (historyStep > 0) {
                    historyStep--;
                    ctx.putImageData(history[historyStep], 0, 0);
                    addToHistory('Undo');
                    showNotification('Undo successful');
                }
            });

            document.getElementById('redoBtn').addEventListener('click', function() {
                if (historyStep < history.length - 1) {
                    historyStep++;
                    ctx.putImageData(history[historyStep], 0, 0);
                    addToHistory('Redo');
                    showNotification('Redo successful');
                }
            });

            // Save state for undo/redo
            function saveState() {
                historyStep++;
                if (historyStep < history.length) {
                    history.length = historyStep;
                }
                history.push(ctx.getImageData(0, 0, canvas.width, canvas.height));
            }

            // Update statistics
            function updateStats() {
                document.getElementById('strokeCount').textContent = strokeCount;
                document.getElementById('wordCount').textContent = wordCount;
                document.getElementById('selectionCount').textContent = selectionCount;
            }

            // Add to history
            function addToHistory(action) {
                const historyList = document.getElementById('historyList');
                const time = new Date().toLocaleTimeString();
                
                const item = document.createElement('div');
                item.className = 'list-group-item d-flex justify-content-between align-items-center';
                item.innerHTML = `
                    <span>${action}</span>
                    <small class="text-muted">${time}</small>
                `;
                
                if (historyList.children[0].textContent === 'No actions yet') {
                    historyList.innerHTML = '';
                }
                
                historyList.insertBefore(item, historyList.firstChild);
                
                // Keep only last 10 items
                while (historyList.children.length > 10) {
                    historyList.removeChild(historyList.lastChild);
                }
            }

            // Show notification
            function showNotification(message) {
                const notification = document.getElementById('notification');
                const notificationText = document.getElementById('notificationText');
                
                notificationText.textContent = message;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }

            // Share functionality
            document.getElementById('shareBtn').addEventListener('click', function() {
                const shareLink = `https://smartboard.app/board/${Math.random().toString(36).substr(2, 9)}`;
                document.getElementById('shareLink').value = shareLink;
                showNotification('Share link generated!');
            });

            document.getElementById('copyLink').addEventListener('click', function() {
                const shareLink = document.getElementById('shareLink').value;
                navigator.clipboard.writeText(shareLink).then(() => {
                    showNotification('Link copied to clipboard!');
                });
            });

            // Save board
            document.getElementById('saveBtn').addEventListener('click', function() {
                const boardData = {
                    canvas: canvas.toDataURL(),
                    timestamp: new Date().toISOString(),
                    stats: {
                        strokes: strokeCount,
                        words: wordCount,
                        selections: selectionCount
                    }
                };
                
                localStorage.setItem('smartBoardData', JSON.stringify(boardData));
                showNotification('Board saved locally!');
            });

            // Load saved board if exists
            const savedData = localStorage.getItem('smartBoardData');
            if (savedData) {
                const data = JSON.parse(savedData);
                const img = new Image();
                img.onload = function() {
                    ctx.drawImage(img, 0, 0);
                    addToHistory('Loaded saved board');
                };
                img.src = data.canvas;
            }
        });
    </script>
</body>
</html>
